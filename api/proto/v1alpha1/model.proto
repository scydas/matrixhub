syntax = "proto3";

package matrixhub.v1alpha1;

option go_package = "github.com/matrixhub-ai/matrixhub/api/go/v1alpha1;v1alpha1";

import "google/api/annotations.proto";
import "validate/validate.proto";
import "v1alpha1/utils.proto";

service Models {
  rpc ListModels(ListModelsRequest) returns (ListModelsResponse) {
    option (google.api.http) = {
      get: "/api/v1alpha1/models"
    };
  }
  rpc GetModel(GetModelRequest) returns (GetModelResponse) {
    option (google.api.http) = {
      get: "/api/v1alpha1/models/{project}/{model_name}"
    };
  }
  rpc CreateModel(CreateModelRequest) returns (CreateModelResponse) {
    option (google.api.http) = {
      post: "/api/v1alpha1/models/{project}/{model_name}"
      body: "*"
    };
  }
  rpc DeleteModel(DeleteModelRequest) returns (DeleteModelResponse) {
    option (google.api.http) = {
      delete: "/api/v1alpha1/models/{project}/{model_name}"
    };
  }
  rpc ListModelBranches(ListModelBranchesRequest) returns (ListModelBranchesResponse) {
    option (google.api.http) = {
      get: "/api/v1alpha1/models/{project}/{model_name}/branches"
    };
  }
  rpc ListModelTags(ListModelTagsRequest) returns (ListModelTagsResponse) {
    option (google.api.http) = {
      get: "/api/v1alpha1/models/{project}/{model_name}/tags"
    };
  }
  rpc GetModelLastCommit(GetModelLastCommitRequest) returns (GetModelLastCommitResponse) {
    option (google.api.http) = {
      get: "/api/v1alpha1/models/{project}/{model_name}/last_commit"
    };
  }
  rpc GetModelCommit(GetModelCommitRequest) returns (GetModelCommitResponse) {
    option (google.api.http) = {
      get: "/api/v1alpha1/models/{project}/{model_name}/commits/{commit_id}"
    };
  }
  rpc GetModelTreeCommits(GetModelTreeCommitsRequest) returns (GetModelTreeCommitsResponse) {
    option (google.api.http) = {
      get: "/api/v1alpha1/models/{project}/{model_name}/refs/{ref=**}/tree_commits/{path=**}"
    };
  }
  rpc GetModelTree(GetModelTreeRequest) returns (GetModelTreeResponse) {
    option (google.api.http) = {
      get: "/api/v1alpha1/models/{project}/{model_name}/refs/{ref=**}/tree"
    };
  }
  rpc GetModelBlob(GetModelBlobRequest) returns (GetModelBlobResponse) {
    option (google.api.http) = {
      get: "/api/v1alpha1/models/{project}/{model_name}/refs/{ref=**}/blob/{path=**}"
    };
  }
}

message ListModelsRequest {
  string label = 1;
  string search = 2;
  string sort = 3;
  int32 page = 4;
  int32 page_size = 5;
}

message ListModelsResponse {
  repeated Model item = 1;
  Pagination pagination = 3;
}

message GetModelRequest {
  string project = 1 [(validate.rules).string.min_len = 1];
  string model_name = 2 [(validate.rules).string.min_len = 1];
}

message GetModelResponse {
  Model model = 1;
}

message CreateModelRequest {
  string project = 1 [(validate.rules).string.min_len = 1];
  string model_name = 2 [(validate.rules).string.min_len = 1];
}

message CreateModelResponse {
}

message DeleteModelRequest {
  string project = 1 [(validate.rules).string.min_len = 1];
  string model_name = 2 [(validate.rules).string.min_len = 1];
}

message DeleteModelResponse {
}

message ListModelBranchesRequest {
  string project = 1 [(validate.rules).string.min_len = 1];
  string model_name = 2 [(validate.rules).string.min_len = 1];
  int32 page = 3;
  int32 page_size = 4;
}

message ListModelBranchesResponse {
  repeated Branch items = 1;
}

message ListModelTagsRequest {
  string project = 1 [(validate.rules).string.min_len = 1];
  string model_name = 2 [(validate.rules).string.min_len = 1];
  int32 page = 3;
  int32 page_size = 4;
}

message ListModelTagsResponse {
  repeated Label items = 1;
}

message GetModelLastCommitRequest {
  string project = 1 [(validate.rules).string.min_len = 1];
  string model_name = 2 [(validate.rules).string.min_len = 1];
}

message GetModelLastCommitResponse {
  string id = 1;
  string message = 2;
  string author_name = 3;
  string author_email = 4;
  string created_at = 5;
}

message GetModelCommitRequest {
  string project = 1 [(validate.rules).string.min_len = 1];
  string model_name = 2 [(validate.rules).string.min_len = 1];
  string commit_id = 3 [(validate.rules).string.min_len = 1];
}

message GetModelCommitResponse {
  string id = 1;
  string message = 2;
  string author_name = 3;
  string author_email = 4;
  string created_at = 5;
}

message GetModelTreeCommitsRequest {
  string project = 1 [(validate.rules).string.min_len = 1];
  string model_name = 2 [(validate.rules).string.min_len = 1];
  string ref = 3 [(validate.rules).string = {min_len:1}];
  string path = 4;
}

message GetModelTreeCommitsResponse {
  repeated GetModelCommitResponse items = 1;
}

message GetModelTreeRequest {
  string project = 1 [(validate.rules).string.min_len = 1];
  string model_name = 2 [(validate.rules).string.min_len = 1];
  string ref = 3;
}

message GetModelTreeResponse {
  repeated GetModelBlobResponse items = 1;
}

message GetModelBlobRequest {
  string project = 1 [(validate.rules).string.min_len = 1];
  string model_name = 2 [(validate.rules).string.min_len = 1];
  string ref = 3;
  string path = 4;
}

message GetModelBlobResponse {
  string name = 1;
  FileType type = 2;
  int64 size = 3;
  string path = 4;
  string sha = 5;
  bool lfs = 6;
  string content = 7;
}

message Model {
  int32  id = 1;
  string name = 2;
  string nickname = 3;
  string default_branch = 4;
  string created_at = 5;
  string updated_at = 6;
  CloneUrls clone_urls = 7;
  repeated Tag tags = 8;
}

message CloneUrls {
  string ssh_url = 1;
  string http_url = 2;
}

message Label {
  int32 id = 1;
  string name = 2;
  string created_at = 3;
  string updated_at = 4;
}

message Branch {
  string name = 2;
  string message = 3;
}

message Tag {
  string name = 1;
}

enum FileType {
  DIR = 0;
  FILE = 1;
}
